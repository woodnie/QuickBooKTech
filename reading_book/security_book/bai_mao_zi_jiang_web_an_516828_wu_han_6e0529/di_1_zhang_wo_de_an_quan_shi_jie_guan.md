#### 第1章 我的安全世界观 {#1}

**1.1 Web** **安全简史** **1.1.1 中国黑客简史** **1.1.2 黑客技术的发展历程** **1.1.3 Web** **安全的兴起** **1.2 黑帽子，白帽子** **1.3 返璞归真，揭秘安全的本质** **1.4 破除迷信，没有银弹**

**1.5~** **安全三要素** 安全三要素是安全的基本组成元素，分别是机密性（ Confidentiality ）、完整性（ Integrity ）、可用性（ Availability ）。

**1.6~** **如何实施安全评估** 一个安全评估的过程，可以简单地分为 4 个阶段：资产等级划分、威胁分析、风险分析、确认解决方案。

**1.6.1~** **资产等级划分** 互联网安全的核心问题，是数据安全的问题。 这与我们做资产评估又有什么关系呢？有，因为对互联网公司拥有的资产进行等级划分，就是对数据做等级划分。有的公司最关心的是客户数据，有的公司最关心的是员工资料信息，根据各自业务的不同，侧重点也不同。做资产等级划分的过程，需要与各个业务部门的负责人一一沟通，了解公司最重要的资产是什么，他们最看重的数据是什么。通过访谈的形式，安全部门才能熟悉、了解公司的业务，公司所拥有的数据，以及不同数据的重要程度，为后续的安全评估过程指明方向。

**1.6.2~** **威胁分析** 在本书中介绍一种威胁建模的方法，它最早是由微软提出的，叫做 STRIDE 模型。 STRIDE 是 6 个单词的首字母缩写，我们在分析威胁时，可以从以下 6 个方面去考虑。

| 威     胁 | 定     义 | 对应的安全属性 |
| --- | --- | --- |
| Spoofing （伪装） | 冒充他人身份 | 认证 |
| Tampering （篡改） | 修改数据或代码 | 完整性 |
| Repudiation （抵赖） | 否认做过的事情 | 不可抵赖性 |
| InformationDisclosure （信息泄露） | 机密信息泄露 | 机密性 |
| Denial of Service （拒绝服务） | 拒绝服务 | 可用性 |
| Elevation of Privilege （提升权限） | 未经授权获得许可 | 授权 |

在进行威胁分析时，要尽可能地不遗漏威胁，头脑风暴的过程可以确定攻击面（ Attack Surface ）。

**1.6.3~** **风险分析** 风险由以下因素组成： Risk~

这里再介绍一个 DREAD 模型，它也是由微软提出的。 DREAD 也是几个单词的首字母缩写，它指导我们应该从哪些方面去判断一个威胁的风险程度。

| 等    级 | 高(3) | 中(2) | 低(1) |
| --- | --- | --- | --- |
| Damage Potential | 获取完全验证权限； |  |  |

执行管理员操作；

非法上传文件 泄露敏感信息 泄露其他信息

| Reproducibility | 攻击者可以随 |
| --- | --- |

意再次攻击 攻击者可以重复

攻击，但有时间限制 攻击者很难

重复攻击过程

| Exploitability | 初学者在短期内能 |
| --- | --- |

掌握攻击方法 熟练的攻击者才能

完成这次攻击 漏洞利用条

件非常苛刻

| Affected users | 所有用户， |
| --- | --- |

默认配置，关键用户 部分用户，

非默认配置 极少数用户，

匿名用户

| Discoverability | 漏洞很显眼， |
| --- | --- |

攻击条件很容易获得 在私有区域，

部分人能看到，

需要深入挖掘漏洞 发现该漏洞

极其困难 在 DREAD 模型里，每一个因素都可以分为高、中、低三个等级。在上表中，高、中、低三个等级分别以 3 、 2 、 1 的分数代表其权重值，因此，我们可以具体计算出某一个威胁的风险值。

**1.6.4~** **设计安全方案** 一个优秀的安全方案应该具备以下特点： 能够有效解决问题； 用户体验好； 高性能； 低耦合； 易于扩展与升级 **。**

**1.7~** **白帽子兵法**

安全方案指导思想 : **1.7.1** Secure by Default **缺省安全** **:** 是时刻要牢记的总则 ; **1.7.1.1.** **黑名单、白名单**

在 Web 安全中，对白名单思想的运用也比比皆是。比如应用处理用户提交的富文本时，考虑到 XSS 的问题，需要做安全检查。常见的 XSS Filter 一般是先对用户输入的 HTML 原文作 HTML Parse ，解析成标签对象后，再针对标签匹配 XSS 的规则。这个规则列表就是一个黑白名单。如果选择黑名单的思想，则这套规则里可能是禁用诸如 &lt;script&gt; 、 &lt;iframe&gt; 等标签。但是黑名单可能会有遗漏，比如未来浏览器如果支持新的 HTML 标签，那么此标签可能就不在黑名单之中了。如果选择白名单的思想，就能避免这种问题 -- 在规则中，只允许用户输入诸如 &lt;a&gt; 、 &lt;img&gt; 等需要用到的标签。对于如何设计一个好的 XSS 防御方案，在 &quot; 跨站脚本攻击 &quot; 一章中还会详细讲到，不在此赘述了。

然而，并不是用了白名单就一定安全了。有朋友可能会问，作者刚才讲到选择白名单的思想会更安全，现在又说不一定，这不是自相矛盾吗？我们可以仔细分析一下白名单思想的本质。在前文中提到： &quot; 安全问题的本质是信任问题，安全方案也是基于信任来做的 &quot; 。选择白名单的思想，基于白名单来设计安全方案，其实就是信任白名单是好的，是安全的。但是一旦这个信任基础不存在了，那么安全就荡然无存。

在 Flash 跨域访问请求里，是通过检查目标资源服务器端的 crossdomain.xml 文件来验证是否允许客户端的 Flash 跨域发起请求的，它使用的是白名单的思想。比如下面这个策略文件：

1\.        &lt;cross-domain-policy&gt;~

2\.        &lt;allow-access-from~

3\.        &lt;allow-access-from~

4\.        &lt;allow-access-from~

5\.        &lt;allow-access-from~

6\.        &lt;allow-access-from~

7\.        &lt;/cross-domain-policy&gt;~

指定了只允许特定域的 Flash 对本域发起请求。可是如果这个信任列表中的域名变得不可信了，那么问题就会随之而来。比如：

1\.        &lt;cross-domain-policy&gt;~

2\.        &lt;allow-access-from~

3\.        &lt;/cross-domain-policy&gt;~

通配符 &quot;*&quot; ，代表来自任意域的 Flash 都能访问本域的数据，因此就造成了安全隐患。所以在选择使用白名单时，需要注意避免出现类似通配符 &quot;*&quot; 的问题。

**1.7.1.2.** **最小权限原则** **1.7.2** Defense in Depth （纵深防御） : 是要更全面、更正确地看待问题； **1.7.3~** **数据与代码分离原则** **:** 是从漏洞成因上看问题； **1.7.4~** Unpredictable （ **不可预测性原则）** **:** 是从克服攻击方法的角度看问题。

微软的 Windows 系统用户多年来深受缓冲区溢出之苦，因此微软在 Windows 的新版本中增加了许多对抗缓冲区溢出等内存攻击的功能。微软无法要求运行在系统中的软件没有漏洞，因此它采取的做法是让漏洞的攻击方法失效。比如，使用 DEP 来保证堆栈不可执行，使用 ASLR 让进程的栈基址随机变化，从而使攻击程序无法准确地猜测到内存地址，大大提高了攻击的门槛。经过实践检验，证明微软的这个思路确实是有效的 -- 即使无法修复 code ，但是如果能够使得攻击的方法无效，那么也可以算是成功的防御。